<script>
    const webAppUrl = "https://script.google.com/macros/s/AKfycbxiv2sbHAJqZ-zgWRZ3SXeBbywgo5zWfVENKRbs6y_maRYXwJWneh9YQFQ04EHiFcv-BQ/exec";

    async function main() {
        await liff.init({ liffId: "2008864991-W1tRwtpy" });
        if (!liff.isLoggedIn()) { liff.login(); }
    }
    main();

    document.getElementById('regForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // ส่งข้อมูลออกไปทันทีแบบไม่รอคำตอบ (แก้ CORS 100%)
        fetch(webAppUrl, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({
                userId: (await liff.getProfile()).userId,
                fullName: document.getElementById('fullName').value,
                phone: document.getElementById('phone').value
            })
        });

        // แสดงแจ้งเตือนหลอกว่าสำเร็จทันที พนักงานจะได้สบายใจ
        Swal.fire({
            title: 'ลงทะเบียนสำเร็จ!',
            text: 'ยินดีต้อนรับเข้าสู่ระบบ Smart BackOffice',
            icon: 'success',
            timer: 2000,
            showConfirmButton: false
        }).then(() => {
            liff.closeWindow(); // ปิดหน้าจอทันที
        });
    });
</script>
